<!--HTML5 page for the collections page-->
<!-- HTML5 document type declaration -->
<!doctype html>
<!-- Root HTML element with language attribute for accessibility -->
<html lang="en">
  <!-- Document head - contains metadata and external resources -->
  <head>
    <!-- Character encoding declaration - tells browser how to interpret text -->
    <meta charset="utf-8" />
    <!-- Viewport meta tag - makes page responsive on mobile devices -->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- Page title that appears in browser tab -->
    <title>COLLECTIONS</title>
    <!-- Tailwind CSS CDN for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Avenir font import with fallback -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Avenir:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      /* Fallback fonts for better compatibility */
      body, * {
        font-family: 'Avenir', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
    </style>
    <!-- Link to external CSS stylesheet for page styling -->
    <link rel="stylesheet" href="styles.css" />
  </head>
  <!-- Document body - contains all visible page content -->
  <body class="bg-black text-white">
    <!-- Navigation bar - fixed at top of page -->
    <nav class="fixed top-0 left-0 right-0 z-10 bg-white/95 backdrop-blur-sm px-6 py-4 flex items-center border-b border-black/10">
      <!-- Left side - Home button -->
      <div class="flex-1 flex justify-start">
        <button class="nav-button bg-transparent text-black border border-black px-6 py-3 text-sm cursor-pointer uppercase hover:bg-black hover:text-white" id="homeBtn">HOME</button>
      </div>
      
      <!-- Center - Logo -->
      <div class="flex-1 flex justify-center items-center">
        <img src="assets/logo.svg" alt="Thu Logo" class="h-8 w-auto object-contain font-bold" />
      </div>
      
      <!-- Right side - Currency selector and Support button -->
      <div class="flex-1 flex justify-end items-center space-x-3">
        <!-- Currency Selector -->
        <div class="currency-selector">
          <select id="currencySelect" class="bg-transparent text-black border border-black px-3 py-2 text-sm cursor-pointer uppercase hover:bg-black hover:text-white transition-all duration-300">
            <option value="USD">USD ($)</option>
            <option value="GBP">GBP (£)</option>
            <option value="VND">VND (₫)</option>
          </select>
        </div>
        <!-- Support button -->
        <button class="nav-button bg-transparent text-black border border-black px-6 py-3 text-sm cursor-pointer uppercase hover:bg-black hover:text-white transition-all duration-300" id="supportBtn">SUPPORT</button>
      </div>
    </nav>

    <!-- Main content area -->
    <main class="pt-20 min-h-screen bg-black">
      <!-- Narrative text section -->
      <section class="flex items-center justify-center min-h-screen">
        <div class="text-center px-6">
          <h1 class="text-4xl md:text-6xl font-light tracking-wide leading-tight" style="font-family: 'Avenir', sans-serif;">
            COLLECTIONS
          </h1>
        </div>
      </section>

      <!-- Gallery section -->
      <section class="pb-20 px-6">
        <div class="max-w-6xl mx-auto">
          <!-- Gallery grid - dynamically generated -->
          <div id="gallery-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Gallery items will be generated here by JavaScript -->
          </div>
        </div>
      </section>
    </main>

    <!-- JavaScript file that handles the navigation functionality -->
    <script>
      // Gallery images data - loaded from backend API
      let galleryImages = [];

  // Load gallery data from backend
  async function loadGalleryData() {
    try {
      console.log('Loading gallery data from API...');
      const response = await fetch('https://thu-website-backend-ught.vercel.app/api/gallery');
      const data = await response.json();
          
          console.log('API response:', data);
          
          // Convert backend data format to collections format
          galleryImages = (data.galleryData || []).map(item => ({
            id: item.id,
            src: item.path, // Convert 'path' to 'src'
            images: item.images || [item.path],
            status: item.status,
            price: item.price // Include price data
          }));
          
          console.log('Processed gallery images:', galleryImages);
          
          // Generate gallery after loading data
          generateGallery();
          setTimeout(animateGalleryItems, 300);
          
          return true; // Return success
        } catch (error) {
          console.error('Error loading gallery data:', error);
          // Fallback to empty array if backend is not available
          galleryImages = [];
          generateGallery();
          return false;
        }
      }

      // Function to normalize image path (convert .jpg to .JPG)
      function normalizeImagePath(path) {
        return path.replace(/\.jpg$/i, '.JPG');
      }

      // Function to generate gallery HTML
      function generateGallery() {
        const galleryGrid = document.getElementById('gallery-grid');
        
        console.log('Generating gallery with', galleryImages.length, 'items');
        
        galleryImages.forEach((imageData, index) => {
          const galleryItem = document.createElement('div');
          galleryItem.className = 'gallery-item group cursor-pointer';
          
          // Normalize the image path to handle .jpg/.JPG case sensitivity
          const normalizedSrc = normalizeImagePath(imageData.src);
          
          // Extract price number for data-price attribute
          const priceNumber = (imageData.price || '$299').replace(/[^0-9.]/g, '');
          
          console.log('Creating gallery item', index, 'with price:', imageData.price, '-> data-price:', priceNumber);
          
          galleryItem.innerHTML = `
            <div class="aspect-square bg-gray-800 rounded-lg overflow-hidden relative">
              <img src="${normalizedSrc}" alt="Gallery Art ${index + 1}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" />
              <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white p-3 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                <div class="text-lg font-semibold price-display" data-price="${priceNumber}" data-currency="USD">${imageData.price || '$299'}</div>
                <div class="text-sm opacity-80">${imageData.status === 'available' ? 'Available' : 'Sold Out'}</div>
              </div>
            </div>
          `;
          
          // Add click handler - navigate to artwork detail page with item ID
          galleryItem.addEventListener('click', () => {
            // Navigate to detail page with item ID (new structure)
            window.location.href = `artwork-detail.html?id=${imageData.id}`;
          });
          
          galleryGrid.appendChild(galleryItem);
        });
        
        console.log('Gallery generation complete. Price elements should now be available.');
      }

      // Navigation functionality
      const homeBtn = document.getElementById('homeBtn');
      const supportBtn = document.getElementById('supportBtn');

      // Home button - navigate back to main page
      if (homeBtn) {
        homeBtn.addEventListener('click', () => {
          window.location.href = 'index.html';
        });
      }

      // Support button functionality
      if (supportBtn) {
        supportBtn.addEventListener('click', () => {
          showSupportModal();
        });
      }

      // Gallery fade animation function
      function animateGalleryItems() {
        const galleryItems = document.querySelectorAll('.gallery-item');
        // this finds all 6 gallery items

        // Add fade-in class to each item with staggered timing
        // looping through each item
        galleryItems.forEach((item, index) => {
          setTimeout(() => {
            item.classList.add('fade-in');
          }, index * 150); // 150ms delay between each item
        });
      }

      // Initialize everything when page loads
      document.addEventListener('DOMContentLoaded', async () => {
        // Load gallery data from backend first
        await loadGalleryData();
        
        // Wait a bit for DOM elements to be fully rendered
        setTimeout(() => {
          // Initialize currency converter after gallery is loaded
          initializeCurrencyConverter();
        }, 500);
      });

      // Currency Converter Functionality
      function initializeCurrencyConverter() {
        const currencySelect = document.getElementById('currencySelect');
        
        if (!currencySelect) {
          console.log('Currency selector not found on this page');
          return;
        }

        // Load saved currency preference
        const savedCurrency = localStorage.getItem('selectedCurrency') || 'USD';
        currencySelect.value = savedCurrency;

        // Currency change event listener
        currencySelect.addEventListener('change', async (e) => {
          const selectedCurrency = e.target.value;
          
          // Save preference
          localStorage.setItem('selectedCurrency', selectedCurrency);
          
          // Update all prices on the page
          await updatePricesOnPage(selectedCurrency);
        });

        // Initial price update
        updatePricesOnPage(savedCurrency);
      }

      async function updatePricesOnPage(targetCurrency) {
        try {
          console.log('Updating prices to currency:', targetCurrency);
          
          // Find all price elements
          const priceElements = document.querySelectorAll('[data-price]');
          
          console.log('Found price elements:', priceElements.length);
          
          if (priceElements.length === 0) {
            console.log('No price elements found on this page');
            return;
          }

          for (const element of priceElements) {
            const originalPrice = element.dataset.price;
            const originalCurrency = element.dataset.currency || 'USD';
            
            console.log('Processing price:', originalPrice, originalCurrency, '->', targetCurrency);
            
            if (originalCurrency === targetCurrency) {
              // Same currency, no conversion needed
              const formattedPrice = formatCurrency(parseFloat(originalPrice), targetCurrency);
              element.textContent = formattedPrice;
              continue;
            }

            try {
        // Convert currency
        const response = await fetch(`https://thu-website-backend-ught.vercel.app/api/currency/convert?amount=${originalPrice}&from=${originalCurrency}&to=${targetCurrency}`);
        const data = await response.json();
              
              console.log('Conversion response:', data);
              
              if (data.success) {
                const convertedPrice = formatCurrency(data.converted.amount, targetCurrency);
                element.textContent = convertedPrice;
                console.log('Converted price:', convertedPrice);
              } else {
                console.error('Currency conversion failed:', data.error);
                // Fallback to original price
                const formattedPrice = formatCurrency(parseFloat(originalPrice), originalCurrency);
                element.textContent = formattedPrice;
              }
            } catch (error) {
              console.error('Error converting currency:', error);
              // Fallback to original price
              const formattedPrice = formatCurrency(parseFloat(originalPrice), originalCurrency);
              element.textContent = formattedPrice;
            }
          }
        } catch (error) {
          console.error('Error updating prices:', error);
        }
      }

      function formatCurrency(amount, currency) {
        const symbols = {
          'USD': '$',
          'GBP': '£',
          'VND': '₫'
        };
        
        const symbol = symbols[currency] || currency;
        
        if (currency === 'VND') {
          // Vietnamese Dong - round to 4 significant figures
          const rounded = parseFloat(amount.toPrecision(4));
          return `${symbol}${Math.round(rounded).toLocaleString('vi-VN')}`;
        } else {
          // USD and GBP - 2 decimal places
          return `${symbol}${amount.toFixed(2)}`;
        }
      }

      // Support Modal Functions
      function showSupportModal() {
        const modal = document.getElementById('supportModal');
        if (modal) {
          modal.classList.remove('hidden');
          modal.style.display = 'flex';
        }
      }

      function closeSupportModal() {
        const modal = document.getElementById('supportModal');
        if (modal) {
          modal.classList.add('hidden');
          modal.style.display = 'none';
        }
      }
    </script>
    <!-- Support Modal -->
    <div id="supportModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
      <div class="bg-black border border-white rounded-lg p-8 max-w-md w-full mx-4">
        <div class="text-center">
          <h3 class="text-xl font-semibold text-white mb-6" style="font-family: 'Avenir', sans-serif;">Get Support</h3>
          <p class="text-white mb-6" style="font-family: 'Avenir', sans-serif;">Choose how you'd like to get in touch:</p>
          <div class="space-y-4">
            <a href="https://www.facebook.com/share/19yFPqmFqE/?mibextid=wwXIfr" 
               target="_blank" 
               class="block w-full bg-transparent border border-white hover:bg-white hover:text-black text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200">
              <div class="flex items-center justify-center">
                <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
                <span style="font-family: 'Avenir', sans-serif;">PhuongThustudio</span>
              </div>
            </a>
            <a href="https://www.instagram.com/phuongthustudio?igsh=YW81MmxpdnN0ZzR0" 
               target="_blank" 
               class="block w-full bg-transparent border border-white hover:bg-white hover:text-black text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200">
              <div class="flex items-center justify-center">
                <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 6.62 5.367 11.987 11.988 11.987 6.62 0 11.987-5.367 11.987-11.987C24.014 5.367 18.637.001 12.017.001zM8.449 16.988c-1.297 0-2.448-.49-3.323-1.297C4.198 14.895 3.708 13.744 3.708 12.447s.49-2.448 1.297-3.323c.875-.807 2.026-1.297 3.323-1.297s2.448.49 3.323 1.297c.807.875 1.297 2.026 1.297 3.323s-.49 2.448-1.297 3.323c-.875.807-2.026 1.297-3.323 1.297zm7.718-1.297c-.875.807-2.026 1.297-3.323 1.297s-2.448-.49-3.323-1.297c-.807-.875-1.297-2.026-1.297-3.323s.49-2.448 1.297-3.323c.875-.807 2.026-1.297 3.323-1.297s2.448.49 3.323 1.297c.807.875 1.297 2.026 1.297 3.323s-.49 2.448-1.297 3.323z"/>
                </svg>
                <span style="font-family: 'Avenir', sans-serif;">PhuongThustudio</span>
              </div>
            </a>
            <a href="mailto:phuongthu.studio25@gmail.com" 
               class="block w-full bg-transparent border border-white hover:bg-white hover:text-black text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200">
              <div class="flex items-center justify-center">
                <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                </svg>
                <span style="font-family: 'Avenir', sans-serif;">phuongthu.studio25@gmail.com</span>
              </div>
            </a>
          </div>
          <button onclick="closeSupportModal()" 
                  class="mt-6 text-white hover:text-gray-300 text-sm underline" style="font-family: 'Avenir', sans-serif;">
            Cancel
          </button>
        </div>
      </div>
    </div>

  </body>
</html>
